# Домашнее задание 4

Продолжающееся развитие социальной сети Zwitter привело к расширению штата сотрудников, занимающихся анлизом данных из социальной сети: 
основатели наняли на работу аналитиков. Основной задачей аналитиков является поиск ответов на конкретные ad-hoc бизнес-запросы;
ценность представляет, в основном конечный результат анализа, а не скорость его выполнения. Аналитики привыкли использовать в своей работе SQL.

## Что надо делать?

В четвертом домашнем задании вам необходимо помочь аналитикам включиться в работу и написать им для примера набор SQL запросов.

Ниже вы можете найти более подробную информацию по следующим вопросам:

  * [Исходные данные](#Исходные-данные)
  * [Рассчитываемые метрики](#Рассчитываемые-метрики)
  * [Требования](#Требования)
  * [Критерии сдачи задания](#Критерии-сдачи-задания)

## Исходные данные

В этом задании используются те же исходные данные, что и в первом домашнем задании: логи доступа к веб-серверу.

Из каждой записи в логе можно выделить **пользователя** и **посещенный профиль**: пользователь определяется IP-адресом,
а посещенный профиль -- идентификатором, закодированном в URI запроса в виде `idNNNNN`.

К примеру, по записи

```
195.206.123.39 - - [24/Sep/2015:12:32:53 +0400] "GET /id18222 HTTP/1.1" 200 10703 "http://bing.com/" "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36"
```

Можно сказать, что пользователь **195.206.123.39** посетил профиль **id18222**.

Как и в первом домашнии задании, для расчета целевых метрик в запросах вам стоит рассматривать только успешные (HTTP-код 200)
запросы к веб-сайту. Неуспешные запросы стоит игнорировать.

## Рассчитываемые метрики

В рамках данного задания вам по логам с 10.12.15 по 15.12.15 необходимо написать запросы, вычисляющие следующие величины:

  * `total_hits` -- Распределение количества запросов к сайту по дням: сколько было успешных запросов в такой-то день.
    Результат запроса содержит два столбца: `date`, `cn`; значения в столбце `date` -- строки формата `YYYY-MM-DD`;
    значения в столбце `cn` -- числа.
  * `most_active_hours` -- TOP-5 cамыx посещаемых часов в сутках (если для каких-то часов количество хитов одинаково,
    необходимо вывести более ранний час).
    Результат запроса содержит один столбец: `hour`; значения в столбце `hour` -- строки формата `HH`.
  * `most_popular_profile` -- Самый популярный профиль для каждого дня (если для каких-то профилей количество хитов одинаково,
    необходимо вывести лексикографически первый профиль).
    Результат запроса содержит два столбца: `date`, `profile`; значения в столбце `date` -- строки формата `YYYY-MM-DD`;
    значения в столбце `profile` -- строки формата `idXXXXX`.
  * `night_owls` -- Количество пользователей, которые отправляли запросы к сайту ночью (между 00:00 и 06:00)
    в течении трех и более различных дней.
    Результат запроса содержит один столбец `cn`; значение в столбце `cn` -- число.
  * `countries` -- Страны, из которых пользователи отправляли запросы в сайту.
    Результат запроса содержит один столбец `country`. Значение в столбце `country` -- строка, содержащая двухбуквенное обозначение страны.
  * `new_users_on_december_15` -- Количество пользователей, которые отправляли запросы к сайту только в последний день -- 15 декабря
    (но не отправляли запросы 10.12, 11.12, 12.12, 13.12, 14.12).
    Результат запроса содержит один столбец `cn`. Значение в столбце `cn` -- число.

## Требования

Ваше решение должно удовлетворять следующим требованиям:

  * метрики должны вычисляться с использованием языка HiveQL;
  * каждая метрика должна быть реализована в виде отдельного запроса;
  * таблицы, на которых вычисляются метрики, должны быть созданы в базе данных, одноименных с вашим логином;
  * написанные запросы должны честно вычислять требуемые метрики, а не использовать предпросчитанные результаты.
  
## Критерии сдачи задания

В данном задании 1 попугай выдается за любые две реализованные метрики.
